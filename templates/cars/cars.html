
{% extends 'base.html' %}
{% block title %}Каталог сельхозтехники{% endblock %}
{% block content %}
{% load humanize %}
<style>
    /* Общие стили для слайдеров и инпутов */
.range-slider {
    margin-top: 2px !important;
    margin-bottom: 20px;
}

.range-inputs {
    display: flex;
    align-items: center;
    margin-bottom: 7px;
    gap: 10px;
}

.range-inputs input {
    flex: 1;
    min-width: 0;


}

.slider-range {
    margin-bottom: 50px !important; ;
    height: 5px; 
}
.form-group-first {
    margin-top: 0px;
    padding-top: 0px ;
    padding-bottom: 0px ;
}
.form-group-next {
 margin-top: 65px;
}
.col-form-label {
    margin-top: 0px !important ;
    margin-bottom: 0px !important;
}
.form-control {
    margin-top: 0px !important;
}
/* Стили для подфильтров в раскрывающихся секциях */
/* .after-slider {
    margin-top: 50px;
    padding-top: 0px;
}  */
.machinery-details {
    /* padding: 10px 0 10px 20px;
     */margin-bottom: 25px;
     margin-top: 5px;
    border-left: 1px solid #eee;
}

/* .machinery-details label {
    margin-top: 1px !important;
    margin-bottom: 1px !important;
} */

.sub-filter {
min-height: 90px;
}
.sub-filter label {
    /* margin-top: 1px !important;
     */margin-bottom: 2px !important;
}

.sub-filter-checkbox {
    margin-top: 20px;
    height: auto;
}


#condition-options, 
#drive-type-options,
#transmission-type-options,
#threshing-type-options,
#seed-type-options,
#tow-class-options {
    margin-bottom: 10px;
}



/* Исправление отступов для чекбоксов */
.checkbox {
    margin-bottom: 10px;
}

/* Исправление для кнопок фильтра */
.form-group.mt-4 {
    margin-top: 30px !important;
}
</style>

<!-- Banner Section -->
<div class="sub-banner overview-bgi">
    <div class="container breadcrumb-area">
        <div class="breadcrumb-areas">
            <h1>Каталог сельхозтехники</h1>
            <ul class="breadcrumbs">
                <li><a href="{% url 'home' %}">Главная</a></li>
                <li class="active">Каталог</li>
            </ul>
        </div>
    </div>
</div>

<!-- Main Content Section -->
<div class="featured-car content-area" id="machinery-container-area">
    <div class="container">
        <div class="row">
            <!-- Left Column: Machinery List -->
            <div class="col-lg-8 col-md-12">
                <!-- Result Count & Sort Options -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h4 id="result-count">Найдено: <span>0</span> единиц техники</h4>
                    </div>
                    <div class="col-md-6 text-right">
                        <select id="sort-select" class="form-control">
                            <option value="-created_date">Сначала новые поступления</option>
                            <option value="price">Сначала дешевле</option>
                            <option value="-price">Сначала дороже</option>
                            <option value="-year">Сначала новее (по году)</option>
                            <option value="year">Сначала старше (по году)</option>
                        </select>
                    </div>
                </div>
                
                <!-- Machinery Cards -->
                <div class="row" id="machinery-list">
                    <!-- Карточки техники будут добавлены через JavaScript -->
                </div>
                
                <!-- Pagination -->
                <div class="pagination-box p-box-2 text-center">
                    <nav aria-label="Page navigation example">
                        <ul class="pagination" id="pagination-container">
                            <!-- Пагинация будет добавлена через JavaScript -->
                        </ul>
                    </nav>
                </div>
            </div>
            
            <!-- Right Column: Filters -->
            <div class="col-lg-4 col-md-12">
                <div class="sidebar-right">
                    <div class="widget advanced-search2">
                        <h3 class="sidebar-title">Фильтры техники</h3>
                        <form id="filter-form">
                            <!-- Machinery Type Filters -->
                            <div class="form-group">
                                <label>Тип техники</label>
                                <div class="machinery-types">
                                    <!-- Тракторы -->
                                    <div class="machinery-type-item">
                                        <div class="checkbox checkbox-theme">
                                            <input type="checkbox" id="type-tractor" name="machinery_type" value="Tractor">
                                            <label for="type-tractor">Тракторы (<span id="count-tractor">0</span>)</label>
                                        </div>
                                        <div class="machinery-details" id="details-tractor" style="display:none; padding-left: 20px;">
                                            <!-- Тип привода -->
                                            <div class="sub-filter">
                                                <label>Тип привода</label>
                                                <div id="drive-type-options">
                                                    <!-- Будет заполнено через JavaScript -->
                                                </div>
                                            </div>
                                            
                                            <!-- Мощность -->
                                            <div class="sub-filter">
                                                <label>Мощность (л.с.)</label>
                                                <div class="range-slider">
                                                    <div class="range-inputs">
                                                        <input type="number" id="power-min" name="power_min" class="form-control" placeholder="От">
                                                        <span>—</span>
                                                        <input type="number" id="power-max" name="power_max" class="form-control" placeholder="До">
                                                    </div>
                                                    <div id="power-slider" class="slider-range"></div>
                                                </div>
                                            </div>
                                            
                                            <!-- Объем двигателя -->
                                            <div class="sub-filter">
                                                <label>Объем двигателя (л)</label>
                                                <div class="range-slider">
                                                    <div class="range-inputs">
                                                        <input type="number" id="engine-volume-min" name="engine_volume_min" class="form-control" placeholder="От">
                                                        <span>—</span>
                                                        <input type="number" id="engine-volume-max" name="engine_volume_max" class="form-control" placeholder="До">
                                                    </div>
                                                    <div id="engine-volume-slider" class="slider-range"></div>
                                                </div>
                                            </div>
                                            
                                            <!-- Тип КПП -->
                                            <div class="sub-filter">
                                                <label>Тип КПП</label>
                                                <div id="transmission-type-options">
                                                    <!-- Будет заполнено через JavaScript -->
                                                </div>
                                            </div>
                                            
                                            <!-- Тяговый класс -->
                                            <div class="sub-filter">
                                                <label>Тяговый класс</label>
                                                <div id="tow-class-options">
                                                    <!-- Будет заполнено через JavaScript -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Комбайны -->
                                    <div class="machinery-type-item">
                                        <div class="checkbox checkbox-theme">
                                            <input type="checkbox" id="type-harvester" name="machinery_type" value="Harvester">
                                            <label for="type-harvester">Комбайны (<span id="count-harvester">0</span>)</label>
                                        </div>
                                        <div class="machinery-details" id="details-harvester" style="display:none; padding-left: 20px;">
                                            <!-- Мощность -->
                                            <div class="sub-filter">
                                                <label>Мощность (л.с.)</label>
                                                <div class="range-slider">
                                                    <div class="range-inputs">
                                                        <input type="number" id="harvester-power-min" name="harvester_power_min" class="form-control" placeholder="От">
                                                        <span>—</span>
                                                        <input type="number" id="harvester-power-max" name="harvester_power_max" class="form-control" placeholder="До">
                                                    </div>
                                                    <div id="harvester-power-slider" class="slider-range"></div>
                                                </div>
                                            </div>
                                            
                                            <!-- Объем бункера -->
                                            <div class="sub-filter">
                                                <label>Объем бункера (м³)</label>
                                                <div class="range-slider">
                                                    <div class="range-inputs">
                                                        <input type="number" id="bunker-volume-min" name="bunker_volume_min" class="form-control" placeholder="От">
                                                        <span>—</span>
                                                        <input type="number" id="bunker-volume-max" name="bunker_volume_max" class="form-control" placeholder="До">
                                                    </div>
                                                    <div id="bunker-volume-slider" class="slider-range"></div>
                                                </div>
                                            </div>
                                            
                                            <!-- Тип системы обмолота -->
                                            <div class="sub-filter">
                                                <label>Тип системы обмолота</label>
                                                <div id="threshing-type-options">
                                                    <!-- Будет заполнено через JavaScript -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Самоходные опрыскиватели -->
                                    <div class="machinery-type-item">
                                        <div class="checkbox checkbox-theme">
                                            <input type="checkbox" id="type-self-sprayer" name="machinery_type" value="SelfPropelledSprayer">
                                            <label for="type-self-sprayer">Самоходные опрыскиватели (<span id="count-selfpropelledsprayer">0</span>)</label>
                                        </div>
                                        <div class="machinery-details" id="details-self-sprayer" style="display:none; padding-left: 20px;">
                                            <!-- Мощность -->
                                            <div class="sub-filter">
                                                <label>Мощность (л.с.)</label>
                                                <div class="range-slider">
                                                    <div class="range-inputs">
                                                        <input type="number" id="self-sprayer-power-min" name="self_sprayer_power_min" class="form-control" placeholder="От">
                                                        <span>—</span>
                                                        <input type="number" id="self-sprayer-power-max" name="self_sprayer_power_max" class="form-control" placeholder="До">
                                                    </div>
                                                    <div id="self-sprayer-power-slider" class="slider-range"></div>
                                                </div>
                                            </div>
                                            
                                            <!-- Рабочая ширина -->
                                            <div class="sub-filter">
                                                <label>Рабочая ширина (м)</label>
                                                <div class="range-slider">
                                                    <div class="range-inputs">
                                                        <input type="number" id="self-sprayer-width-min" name="self_sprayer_width_min" class="form-control" placeholder="От">
                                                        <span>—</span>
                                                        <input type="number" id="self-sprayer-width-max" name="self_sprayer_width_max" class="form-control" placeholder="До">
                                                    </div>
                                                    <div id="self-sprayer-width-slider" class="slider-range"></div>
                                                </div>
                                            </div>
                                            
                                            <!-- Объем бака -->
                                            <div class="sub-filter">
                                                <label>Объем бака (л)</label>
                                                <div class="range-slider">
                                                    <div class="range-inputs">
                                                        <input type="number" id="self-sprayer-tank-min" name="self_sprayer_tank_min" class="form-control" placeholder="От">
                                                        <span>—</span>
                                                        <input type="number" id="self-sprayer-tank-max" name="self_sprayer_tank_max" class="form-control" placeholder="До">
                                                    </div>
                                                    <div id="self-sprayer-tank-slider" class="slider-range"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="machinery-type-item">
                                        <div class="checkbox checkbox-theme">
                                            <input type="checkbox" id="type-trailed-sprayer" name="machinery_type" value="TrailedSprayer">
                                            <label for="type-trailed-sprayer">Прицепные опрыскиватели (<span id="count-trailedsprayer">0</span>)</label>
                                        </div>
                                    </div>
                                    
                                    <!-- Плуги -->
                                    <div class="machinery-type-item">
                                        <div class="checkbox checkbox-theme">
                                            <input type="checkbox" id="type-plow" name="machinery_type" value="Plow">
                                            <label for="type-plow">Плуги (<span id="count-plow">0</span>)</label>
                                        </div>
                                        <div class="machinery-details" id="details-plow" style="display:none; padding-left: 20px;">
                                            <!-- Рабочая ширина -->
                                            <div class="sub-filter">
                                                <label>Рабочая ширина (м)</label>
                                                <div class="range-slider">
                                                    <div class="range-inputs">
                                                        <input type="number" id="plow-width-min" name="plow_width_min" class="form-control" placeholder="От">
                                                        <span>—</span>
                                                        <input type="number" id="plow-width-max" name="plow_width_max" class="form-control" placeholder="До">
                                                    </div>
                                                    <div id="plow-width-slider" class="slider-range"></div>
                                                </div>
                                            </div>
                                            
                                            <!-- Количество корпусов -->
                                            <div class="sub-filter">
                                                <label>Количество корпусов</label>
                                                <div class="range-slider">
                                                    <div class="range-inputs">
                                                        <input type="number" id="bodies-min" name="bodies_min" class="form-control" placeholder="От">
                                                        <span>—</span>
                                                        <input type="number" id="bodies-max" name="bodies_max" class="form-control" placeholder="До">
                                                    </div>
                                                    <div id="bodies-slider" class="slider-range"></div>
                                                </div>
                                            </div>
                                            
                                            <!-- Оборотный -->
                                            <div class="sub-filter-checkbox">
                                                <div class="checkbox checkbox-theme">
                                                    <input type="checkbox" id="reversible" name="reversible" value="true">
                                                    <label for="reversible">Оборотный</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Сеялки -->
                                    <div class="machinery-type-item">
                                        <div class="checkbox checkbox-theme">
                                            <input type="checkbox" id="type-seeder" name="machinery_type" value="Seeder">
                                            <label for="type-seeder">Сеялки (<span id="count-seeder">0</span>)</label>
                                        </div>
                                        <div class="machinery-details" id="details-seeder" style="display:none; padding-left: 20px;">
                                            <!-- Рабочая ширина -->
                                            <div class="sub-filter">
                                                <label>Ширина высева (м)</label>
                                                <div class="range-slider">
                                                    <div class="range-inputs">
                                                        <input type="number" id="seeder-width-min" name="seeder_width_min" class="form-control" placeholder="От">
                                                        <span>—</span>
                                                        <input type="number" id="seeder-width-max" name="seeder_width_max" class="form-control" placeholder="До">
                                                    </div>
                                                    <div id="seeder-width-slider" class="slider-range"></div>
                                                </div>
                                            </div>
                                            
                                            <!-- Ёмкость бункера семян -->
                                            <div class="sub-filter">
                                                <label>Ёмкость бункера семян</label>
                                                <div class="range-slider">
                                                    <div class="range-inputs">
                                                        <input type="number" id="seed-tank-capacity-min" name="seed_tank_capacity_min" class="form-control" placeholder="От">
                                                        <span>—</span>
                                                        <input type="number" id="seed-tank-capacity-max" name="seed_tank_capacity_max" class="form-control" placeholder="До">
                                                    </div>
                                                    <div id="seed-tank-capacity-slider" class="slider-range"></div>
                                                </div>
                                            </div>

                                            <!-- Емкость бункера удобрений-->
                                            <div class="sub-filter">
                                                <label>Емкость бункера удобрений</label>
                                                <div class="range-slider">
                                                    <div class="range-inputs">
                                                        <input type="number" id="fert-tank-capacity-min" name="fert_tank_capacity_min" class="form-control" placeholder="От">
                                                        <span>—</span>
                                                        <input type="number" id="fert-tank-capacity-max" name="fert_tank_capacity_max" class="form-control" placeholder="До">
                                                    </div>
                                                    <div id="fert-tank-capacity-slider" class="slider-range"></div>
                                                </div>
                                            </div>
                                            
                                            <!-- Тип сеялки -->
                                            <div class="sub-filter">
                                                <label>Тип сеялки</label>
                                                <div id="seed-type-options">
                                                    <!-- Будет заполнено через JavaScript -->
                                                </div>
                                            </div>

                                            
                                            
                                        </div>
                                    </div>
                                    
                                    <div class="machinery-type-item">
                                        <div class="checkbox checkbox-theme">
                                            <input type="checkbox" id="type-harrow" name="machinery_type" value="Harrow">
                                            <label for="type-harrow">Бороны (<span id="count-harrow">0</span>)</label>
                                        </div>
                                    </div>
                                    
                                    
                                    
                                    <div class="machinery-type-item">
                                        <div class="checkbox checkbox-theme">
                                            <input type="checkbox" id="type-mower" name="machinery_type" value="Mower">
                                            <label for="type-mower">Косилки (<span id="count-mower">0</span>)</label>
                                        </div>
                                    </div>
                                    
                                    <div class="machinery-type-item">
                                        <div class="checkbox checkbox-theme">
                                            <input type="checkbox" id="type-baler" name="machinery_type" value="Baler">
                                            <label for="type-baler">Пресс-подборщики (<span id="count-baler">0</span>)</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Common Filters -->
                            <div class="form-group">
                                <label>Производители</label>
                                <div id="manufacturers-container">
                                    <!-- Будет заполнено через JavaScript -->
                                </div>
                            </div>
                            
                            <div class="form-group-first">
                                <label class="col-form-label">Год выпуска</label>
                                <div class="range-slider">
                                    <div class="range-inputs">
                                        <input type="number" id="year-min" name="year_min" class="form-control" placeholder="От">
                                        <span>—</span>
                                        <input type="number" id="year-max" name="year_max" class="form-control" placeholder="До">
                                    </div>
                                    <div id="year-slider" class="slider-range"></div>
                                </div>
                            </div>
                            
                            <div class="form-group-next">
                                <label class="col-form-label">Цена (₽)</label>
                                <div class="range-slider">
                                    <div class="range-inputs">
                                        <input type="number" id="price-min" name="price_min" class="form-control" placeholder="От">
                                        <span>—</span>
                                        <input type="number" id="price-max" name="price_max" class="form-control" placeholder="До">
                                    </div>
                                    <div id="price-slider" class="slider-range"></div>
                                </div>
                            </div>
                            
                            <div class="form-group-next">
                                <label>Состояние</label>
                                <div id="condition-options">
                                    <div class="checkbox checkbox-theme">
                                        <input type="checkbox" id="condition-new" name="condition_in" value="new">
                                        <label for="condition-new">Новый</label>
                                    </div>
                                    <div class="checkbox checkbox-theme">
                                        <input type="checkbox" id="condition-used" name="condition_in" value="used">
                                        <label for="condition-used">Б/У</label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Filter Buttons -->
                            <div class="form-group mt-4 d-flex justify-content-between">
                                <button id="filter-button" type="button" class="btn button-theme btn-md">
                                    <i class="fa fa-filter"></i> Применить
                                </button>
                                <button id="reset-button" type="button" class="btn btn-outline-secondary btn-md">
                                    <i class="fa fa-refresh"></i> Сбросить
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Template for Machinery Card -->
<template id="machinery-card-template">
    <div class="col-lg-6 col-md-6">
        <div class="car-box-3">
            <div class="car-thumbnail">
                <a href="#" class="car-img machinery-link">
                    <div class="tag-2 condition-tag"></div>
                    <div class="price-box"><span class="price-text"></span></div>
                    <img class="d-block w-100" src="" alt="machinery" style="min-height: 262px; max-height: 262px;">
                </a>
                <div class="carbox-overlap-wrapper">
                    <div class="overlap-box">
                        <div class="overlap-btns-area">
                            <div class="car-magnify-gallery">
                                <a href="" class="overlap-btn">
                                    <i class="fa fa-expand"></i>
                                    <img class="hidden" src="">
                                </a>
                                <!-- Дополнительные фото будут добавлены через JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="detail">
                <h1 class="title"><a href="#" class="machinery-title machinery-link"></a></h1>
                <div class="location">
                    <a href="#" class="machinery-link"></a>
                </div>
                <ul class="facilities-list clearfix machinery-specs">
                    <!-- Характеристики будут добавлены через JavaScript -->
                </ul>
            </div>
        </div>
    </div>
</template>

{% endblock %}

{% block extra_js %}
<!-- Дополнительные скрипты для фильтрации и слайдеров -->
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/1.10.0/js/lightgallery-all.min.js"></script>

{% endblock %}


